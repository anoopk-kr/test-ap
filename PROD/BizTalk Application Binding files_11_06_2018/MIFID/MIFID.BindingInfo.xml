<?xml version="1.0" encoding="utf-8"?>
<BindingInfo xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" Assembly="Microsoft.BizTalk.Deployment, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Version="3.5.1.0" BindingStatus="NoBindings" BoundEndpoints="0" TotalEndpoints="0">
  <Timestamp>2018-11-06T10:50:39.9874992-08:00</Timestamp>
  <ModuleRefCollection>
    <ModuleRef Name="[Application:MIFID]" Version="" Culture="" PublicKeyToken="" FullName="[Application:MIFID], Version=, Culture=, PublicKeyToken=">
      <Services />
      <TrackedSchemas />
    </ModuleRef>
  </ModuleRefCollection>
  <SendPortCollection>
    <SendPort Name="SendPort_MIFID_Report_Out" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>SFTP://krogerinv.prd@nrr-sftp-prd.abide-financial.com:22/Incoming/MiFID/%SourceFileName%</Address>
        <TransportType Name="nsoftware.SFTP 2016" Capabilities="15627" ConfigurationClsid="7571227c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;AfterConnect /&amp;gt;&amp;lt;AfterPut /&amp;gt;&amp;lt;Append&amp;gt;False&amp;lt;/Append&amp;gt;&amp;lt;BeforePut /&amp;gt;&amp;lt;CertPassSSOAffiliate /&amp;gt;&amp;lt;ConnectionLifetime&amp;gt;0&amp;lt;/ConnectionLifetime&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Overwrite&amp;gt;False&amp;lt;/Overwrite&amp;gt;&amp;lt;RemoteFile&amp;gt;%SourceFileName%&amp;lt;/RemoteFile&amp;gt;&amp;lt;RemotePath&amp;gt;/Incoming/MiFID&amp;lt;/RemotePath&amp;gt;&amp;lt;RemoteTempPath /&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;True&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;0&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;SSHHost&amp;gt;nrr-sftp-prd.abide-financial.com&amp;lt;/SSHHost&amp;gt;&amp;lt;SSHPassword&amp;gt;******&amp;lt;/SSHPassword&amp;gt;&amp;lt;SSHPort&amp;gt;22&amp;lt;/SSHPort&amp;gt;&amp;lt;SSHUser&amp;gt;krogerinv.prd&amp;lt;/SSHUser&amp;gt;&amp;lt;SSOAffiliate /&amp;gt;&amp;lt;Timeout&amp;gt;600&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;0&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;SFTP://&amp;lt;/URIIdentity&amp;gt;&amp;lt;uri&amp;gt;SFTP://krogerinv.prd@nrr-sftp-prd.abide-financial.com:22/Incoming/MiFID/%SourceFileName%&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>30</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="nsoftware.SFTP 2016" Capabilities="15627" ConfigurationClsid="7571227c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Report_Out" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>2</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_Response_In" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>PowerShell://MIFID_Response_In</Address>
        <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;22&amp;lt;/Port&amp;gt;&amp;lt;PortName&amp;gt;MIFID_Response_In&amp;lt;/PortName&amp;gt;&amp;lt;Protocol&amp;gt;0&amp;lt;/Protocol&amp;gt;&amp;lt;Script&amp;gt;function WriteLog
{
    param([bool]$isError, [string]$message)
	$source="nsoftware BizTalk PowerShell Transmit Adapter";
	Try {
		$msg =$message[0..32765] -join ""
		
		if($isError) { 
			$entryType="Error";
		} else {
			$entryType="Information"; 
		}

		write-eventlog -logname Application -source "nsoftware BizTalk PowerShell Transmit Adapter" -eventID 3001 -entrytype Information -message $msg
	}
	catch {
		 $subject="Error in SendPort_MIFID_Response_In PowerShell script"
		 Send-MailMessage -To @("mi.lu@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $_.Message -Priority High		
	}
}
function  SendEmail
{
    param([string]$subject, [string]$html, [bool]$highPriority, [string] $smtpServer)
    WriteLog $False $smtpServer
    WriteLog $False  ("SendEmail "+$smtpServer)
    if($highPriority){
        Send-MailMessage -To @("~MIFIDSupport@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html -Priority High 
    }
    else{
        Send-MailMessage -To @("~MIFIDSupport@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html
    }
} 
function process-XSLT 
{
  param([string]$xml, [string]$xslFileName) 
 
     try
    {
        [System.Xml.XmlDocument]$xmldoc = new-object System.Xml.XmlDocument
        $xmldoc.LoadXml($xml);
        $output = New-Object System.IO.MemoryStream 
        $xslt = New-Object System.Xml.Xsl.XslCompiledTransform 
        $arglist = new-object System.Xml.Xsl.XsltArgumentList 
        $reader = new-object System.IO.StreamReader($output) 
        $xslt.Load($xslFileName)
        [System.Xml.XmlReader]$xmlReader = new-object  System.Xml.XmlNodeReader($xmldoc);
	    $xslt.Transform($xmlReader, $arglist, $output) 
 	    $output.position = 0  
	    $transformed = [string]$reader.ReadToEnd() 
 	    $reader.Close() 
    }
    catch
    {
        $ErrorMessage = $_.Exception.Message
         WriteLog $True $ErrorMessage
    }
 	return $transformed 
 } 
  
  $XmlDocument = [xml] $message.GetBody()
  
  &amp;amp;lt;#
  $xslFileName="F:\krogerApplications\MIFID\BizTalk\XSLT\MifidResponse.xslt";
  $rootFolder=$PSScriptRoot
  write-host $rootFolder
  $xmlFileName=$PSScriptRoot+"\MifidResponseSample.xml";
  
  [xml]$XmlDocument = Get-Content -Path $xmlFileName;
  
  #&amp;amp;gt;
  
  
	WriteLog $False "MIFID Response Start to process";
     
	[int]$SourceResultCode=$XmlDocument.DocumentElement.Header["SourceResultCode"].InnerText;
   
	[string]$xml=[string] $XmlDocument.get_OuterXml()
    $html=(process-XSLT    $xml  $xslFileName)

    $isSending=$True;
    switch ($SourceResultCode) 
    { 
        0 {
            $subject="Mifid Report: Success";
            $highPriority=$False;
          } 
        100 {
            $subject="Mifid Report: Warning";
            $highPriority=$False;
            $isSending= $False;
            } 
        200 {
            $subject="Mifid Report: Warning";
            $highPriority=$False;
          } 
        300 {
            $subject="Mifid Report: Not validated";
            $highPriority=$False;
            } 
        400 {
            $subject="Mifid Report: Not enriched";
            $highPriority=$False;
            } 
        500 {
            $subject="Mifid Report: Processing";
            $highPriority=$False;
            } 
        600 {
            $subject="Mifid Report: Not reportable";
            $highPriority=$False;
            } 
        default {}
    }

     if(    $isSending) {
       SendEmail $subject $html  $highPriority $smtpServer
    }
	WriteLog $False "MIFID Response processed!";
&amp;lt;/Script&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;False&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;2&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;Timeout&amp;gt;60&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;3&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;PowerShell://&amp;lt;/URIIdentity&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;Variables&amp;gt;smtpServer=mailblast.fi.com
xslFileName=F:\krogerApplications\MIFID\BizTalk\XSLT\MifidResponse.xslt
&amp;lt;/Variables&amp;gt;&amp;lt;uri&amp;gt;PowerShell://MIFID_Response_In&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Response_In" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_OnDemand" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>PowerShell://Powershell_MIFID_OnDemand</Address>
        <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;22&amp;lt;/Port&amp;gt;&amp;lt;PortName&amp;gt;Powershell_MIFID_OnDemand&amp;lt;/PortName&amp;gt;&amp;lt;Protocol&amp;gt;0&amp;lt;/Protocol&amp;gt;&amp;lt;RuntimeLicense /&amp;gt;&amp;lt;Script&amp;gt;function WriteLog($msg){
    write-eventlog -logname Application -source "nsoftware BizTalk PowerShell Transmit Adapter" -eventID 3001 -entrytype Information -message $msg 
}
function WriteError($msg){
    write-eventlog -logname Application -source "nsoftware BizTalk PowerShell Transmit Adapter" -eventID 3001 -entrytype Error -message $msg 
}
function SqlQueryExecute($query)
{
	try
	{
		WriteLog("Run Query="+$query);
		$error.clear();
		Invoke-Sqlcmd -ServerInstance $server  -database $database  -Query $query -QueryTimeout 600 -OutputSqlErrors $True -ErrorAction  STOP
	}
	catch
	{
		$errmsg="";
		foreach($err in $error) { 
			 if($err -like "SQLServerAgent Error: Request*refused because the job is already running from a request by Schedule*")
			 {
				return $false;
			 }
			$errmsg=$errmsg+$err; 						 			
		}
		WriteError($errmsg);
		throw $errmsg
	}
	return $true;
}
# main script to repeat calling the query until succeed.
$query="EXEC RUN_MIFID_SSIS_JOB"
$msg="calling EXEC RUN_MIFID_SSIS_JOB.`nquery="+$query +"`nServer=" +$server + "`ndatabase="+$database;
WriteLog ($msg);
$succ=$false;
$errmsg="";
try
{
	WriteLog ("Start calling EXEC RUN_MIFID_SSIS_JOB!");
	while ($succ -eq $false)
	{
		$succ=SqlQueryExecute ($query);
		if(-not $succ)
		{
			Start-Sleep -s 60
		}
	}
	WriteLog ("calling EXEC RUN_MIFID_SSIS_JOB SUCCESS!");
}catch
{		
	foreach($err in $error) { $errmsg=$errmsg+$err;} 
	WriteError($errmsg);
	throw $errmsg
}
&amp;lt;/Script&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;False&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;2&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;Timeout&amp;gt;60&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;3&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;PowerShell://&amp;lt;/URIIdentity&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;Variables&amp;gt;server=fin-reporting-db
database=MIFID
&amp;lt;/Variables&amp;gt;&amp;lt;uri&amp;gt;PowerShell://Powershell_MIFID_OnDemand&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_OnDemand" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_OnDemand_CopyTo_ManualTrade" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\ManualTrade\%SourceFileName%</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;1&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;%SourceFileName%&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_OnDemand" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_Out_Archive" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\MiFIDOutput\Archive\%SourceFileName%</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;2&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;%SourceFileName%&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>68</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Report_Out" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_Out_Notification" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>PowerShell://PowerShell_MIFID_Out_Notification</Address>
        <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;22&amp;lt;/Port&amp;gt;&amp;lt;PortName&amp;gt;PowerShell_MIFID_Out_Notification&amp;lt;/PortName&amp;gt;&amp;lt;Protocol&amp;gt;0&amp;lt;/Protocol&amp;gt;&amp;lt;RuntimeLicense /&amp;gt;&amp;lt;Script&amp;gt;function WriteLog
{
    param([bool]$isError, [string]$message)
    if($isError) { 
        Write-EventLog -LogName "Application" -Source "BizTalk Server" -EventID 1 -EntryType Error -Message $message
    } else {
        Write-EventLog -LogName "Application" -Source "BizTalk Server" -EventID 1 -EntryType Information -Message $message
    }
}
function  SendEmail
{
    param([string]$subject, [string]$html, [bool]$highPriority, [string] $smtpServer)
    WriteLog $False $smtpServer
    WriteLog $False  "SendEmail "+$smtpServer
    if($highPriority){
        Send-MailMessage -To @("~MIFIDSupport@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html -Priority High 
    }
    else{
        Send-MailMessage -To @("~MIFIDSupport@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html
    }
} 
function  PrepareEmailBody
{
    $html="&amp;amp;lt;HTML&amp;amp;gt;&amp;amp;lt;BODY&amp;amp;gt;&amp;amp;lt;h&amp;amp;gt;MIFID File uploaded&amp;amp;lt;/h&amp;amp;gt;&amp;amp;lt;/BODY&amp;amp;gt;&amp;amp;lt;/HTML&amp;amp;gt;"
    return $html;
}
function GetNumberOfLines($InStream)
{
    $file = New-Object System.IO.StreamReader -Arg $InStream
    $i=-1;
    while ($line = $file.ReadLine()) {
        $i=$i+1; 
    }
    $file.close()
  
    $InStream.Close()
    $InStream.Dispose()
    return $i;
}  
  
   
  WriteLog $False "MIFID File uploaded";
  WriteLog $False  "smtpServer "+$smtpServer
  $time=(Get-Date -format "M/d/yyyy hh:mm tt")
     
  $filename= $message.GetProperty("ReceivedFileName","http://schemas.microsoft.com/BizTalk/2003/file-properties" ); 
  $InStream = $message.ReadBodyPart(); 
  $numberOfLines=GetNumberOfLines $InStream 
  WriteLog $False  "filename "+$filename
  $html=(PrepareEmailBody)
  $html="&amp;amp;lt;HTML&amp;amp;gt;&amp;amp;lt;BODY&amp;amp;gt;&amp;amp;lt;h&amp;amp;gt;MIFID File uploaded at $time &amp;amp;lt;/h&amp;amp;gt;"
  $html=$html+ "&amp;amp;lt;br/&amp;amp;gt;" + $filename;
  $html=$html+ "&amp;amp;lt;br/&amp;amp;gt;There are " + $numberOfLines.ToString() +" Records in the report uploaded&amp;amp;lt;br/&amp;amp;gt;"
  $html=$html+"&amp;amp;lt;/BODY&amp;amp;gt;&amp;amp;lt;/HTML&amp;amp;gt;"
  WriteLog $False $html
  
  $subject="Mifid Report: Uploaded at " +$time;
  $highPriority=$False;
  WriteLog $False $subject
  WriteLog $False $highPriority
  SendEmail $subject $html  $highPriority $smtpServer
  WriteLog $False "MIFID Response processed!";
&amp;lt;/Script&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;False&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;2&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;Timeout&amp;gt;60&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;3&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;PowerShell://&amp;lt;/URIIdentity&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;Variables&amp;gt;smtpServer=mailblast.fi.com&amp;lt;/Variables&amp;gt;&amp;lt;uri&amp;gt;PowerShell://PowerShell_MIFID_Out_Notification&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="TrackingHost" HostTrusted="false">
          <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Report_Out" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_Report_Out_TEST" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>PowerShell://Powershell_MIFID_Report_Out_TEST</Address>
        <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;22&amp;lt;/Port&amp;gt;&amp;lt;PortName&amp;gt;Powershell_MIFID_Report_Out_TEST&amp;lt;/PortName&amp;gt;&amp;lt;Protocol&amp;gt;0&amp;lt;/Protocol&amp;gt;&amp;lt;RuntimeLicense /&amp;gt;&amp;lt;Script&amp;gt;function WriteLog
{
    param([bool]$isError, [string]$message)
    if($isError) { 
        Write-EventLog -LogName "Application" -Source "BizTalk Server" -EventID 1 -EntryType Error -Message $message
    } else {
        Write-EventLog -LogName "Application" -Source "BizTalk Server" -EventID 1 -EntryType Information -Message $message
    }
}
function  SendEmail
{
    param([string]$subject, [string]$html, [bool]$highPriority, [string] $smtpServer)
    WriteLog $False $smtpServer
    WriteLog $False  "SendEmail "+$smtpServer
    if($highPriority){
        Send-MailMessage -To @("mi.lu@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html -Priority High 
    }
    else{
        Send-MailMessage -To @("mi.lu@fi.com") -From "~MIFIDSupport@fi.com" -Subject $subject -SmtpServer $smtpServer -BodyAsHtml $html
    }
} 
function  PrepareEmailBody
{
    $html="&amp;amp;lt;HTML&amp;amp;gt;&amp;amp;lt;BODY&amp;amp;gt;&amp;amp;lt;h&amp;amp;gt;MIFID File uploaded&amp;amp;lt;/h&amp;amp;gt;&amp;amp;lt;/BODY&amp;amp;gt;&amp;amp;lt;/HTML&amp;amp;gt;"
    return $html;
}
  
  
   
  WriteLog $False "MIFID File uploaded";
  WriteLog $False  "smtpServer "+$smtpServer
  $time=(Get-Date -format "M/d/yyyy hh:mm tt")
     
  $filename= $message.GetProperty("ReceivedFileName","http://schemas.microsoft.com/BizTalk/2003/file-properties" ); 
  WriteLog $False  "filename "+$filename
  $html=(PrepareEmailBody)
  $html="&amp;amp;lt;HTML&amp;amp;gt;&amp;amp;lt;BODY&amp;amp;gt;&amp;amp;lt;h&amp;amp;gt;MIFID File uploaded at $time &amp;amp;lt;/h&amp;amp;gt;"
  $html=$html+ "&amp;amp;lt;br&amp;amp;gt;&amp;amp;lt;/br&amp;amp;gt;" + $filename;
  $html=$html+"&amp;amp;lt;/BODY&amp;amp;gt;&amp;amp;lt;/HTML&amp;amp;gt;"
  WriteLog $False $html
  
  $subject="Mifid Report: Uploaded at " +$time;
  $highPriority=$False;
  WriteLog $False $subject
  WriteLog $False $highPriority
  SendEmail $subject $html  $highPriority $smtpServer
  WriteLog $False "MIFID Response processed!";
&amp;lt;/Script&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;False&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;2&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;Timeout&amp;gt;60&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;3&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;PowerShell://&amp;lt;/URIIdentity&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;Variables&amp;gt;smtpServer=mailblast.fi.com&amp;lt;/Variables&amp;gt;&amp;lt;uri&amp;gt;PowerShell://Powershell_MIFID_Report_Out_TEST&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="TrackingHost" HostTrusted="false">
          <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>0</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Report_Out_TEST" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_UBS_SecTransactions" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\SecTransactions.txt</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;2&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;SecTransactions.txt&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_UBS_SecTransactions" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_UBS_Holdings" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\Holdings.txt</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;2&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;Holdings.txt&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_UBS_Holdings" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_UBS_Start" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>PowerShell://Powershell_MIFID_UBS_Email</Address>
        <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;22&amp;lt;/Port&amp;gt;&amp;lt;PortName&amp;gt;Powershell_MIFID_UBS_Email&amp;lt;/PortName&amp;gt;&amp;lt;Protocol&amp;gt;0&amp;lt;/Protocol&amp;gt;&amp;lt;RuntimeLicense /&amp;gt;&amp;lt;Script&amp;gt;function WriteLog($msg){
    write-eventlog -logname Application -source "nsoftware BizTalk PowerShell Transmit Adapter" -eventID 3001 -entrytype Information -message $msg 
}
function WriteError($msg){
    write-eventlog -logname Application -source "nsoftware BizTalk PowerShell Transmit Adapter" -eventID 3001 -entrytype Error -message $msg 
}
function SqlQueryExecute($query)
{
	try
	{
		WriteLog("Run Query="+$query);
		$error.clear();
		Invoke-Sqlcmd -ServerInstance $server  -database $database  -Query $query -QueryTimeout 600 -OutputSqlErrors $True -ErrorAction  STOP
	}
	catch
	{
		$errmsg="";
		foreach($err in $error) { 
			 if($err -like "SQLServerAgent Error: Request*refused because the job is already running from a request by Schedule*")
			 {
				return $false;
			 }
			$errmsg=$errmsg+$err; 						 			
		}
		WriteError($errmsg);
		throw $errmsg
	}
	return $true;
}
# main script to repeat calling the query until succeed.
$query="EXEC RUN_MIFID_SSIS_JOB_UBS"
$msg="calling EXEC RUN_MIFID_SSIS_JOB_UBS.`nquery="+$query +"`nServer=" +$server + "`ndatabase="+$database;
WriteLog ($msg);
$succ=$false;
$errmsg="";
try
{
	WriteLog ("Start calling EXEC RUN_MIFID_SSIS_JOB_UBS!");
               # sleep a few seconds to ensure the copy of email has finished.
                Start-Sleep -s 5
	while ($succ -eq $false)
	{
		$succ=SqlQueryExecute ($query);
		if(-not $succ)
		{
			Start-Sleep -s 60
		}
	}
	WriteLog ("calling EXEC RUN_MIFID_SSIS_JOB_UBS SUCCESS!");
}catch
{		
	foreach($err in $error) { $errmsg=$errmsg+$err;} 
	WriteError($errmsg);
	throw $errmsg
}
&amp;lt;/Script&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;False&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;2&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;Timeout&amp;gt;60&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;3&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;PowerShell://&amp;lt;/URIIdentity&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;Variables&amp;gt;server=fin-reporting-db
database=MIFID
&amp;lt;/Variables&amp;gt;&amp;lt;uri&amp;gt;PowerShell://Powershell_MIFID_UBS_Email&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="nsoftware.PowerShell 2016" Capabilities="9474" ConfigurationClsid="7571287c-f326-4248-a478-8748270376f7" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_UBS_Email" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_UBS_Email_Copy" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\%SourceFileName%</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;2&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;%SourceFileName%&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2000-01-01T08:00:00</FromTime>
        <ToTime>2000-01-01T07:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>204</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_UBS_Email" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
    <SendPort Name="SendPort_MIFID_Response_In_Archive" IsStatic="true" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <TransmitPipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruTransmit, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="2" TrackingOption="None" Description="" />
      <PrimaryTransport>
        <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\Archive\Resonse\%SourceFileName%</Address>
        <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        <TransportTypeData>&lt;CustomProps&gt;&lt;UseTempFileOnWrite vt="11"&gt;0&lt;/UseTempFileOnWrite&gt;&lt;AllowCacheOnWrite vt="11"&gt;0&lt;/AllowCacheOnWrite&gt;&lt;CopyMode vt="19"&gt;1&lt;/CopyMode&gt;&lt;FileName vt="8"&gt;%SourceFileName%&lt;/FileName&gt;&lt;/CustomProps&gt;</TransportTypeData>
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2018-06-25T07:00:00</FromTime>
        <ToTime>2018-06-26T06:59:59</ToTime>
        <Primary>true</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler Name="MIFID_HOST" HostTrusted="false">
          <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
        </SendHandler>
      </PrimaryTransport>
      <SecondaryTransport>
        <Address />
        <RetryCount>3</RetryCount>
        <RetryInterval>5</RetryInterval>
        <ServiceWindowEnabled>false</ServiceWindowEnabled>
        <FromTime>2018-06-25T07:00:00</FromTime>
        <ToTime>2018-06-26T06:59:59</ToTime>
        <Primary>false</Primary>
        <OrderedDelivery>false</OrderedDelivery>
        <DeliveryNotification>1</DeliveryNotification>
        <SendHandler xsi:nil="true" />
      </SecondaryTransport>
      <ReceivePipelineData xsi:nil="true" />
      <Tracking>0</Tracking>
      <Filter>&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;Filter xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
  &lt;Group&gt;
    &lt;Statement Property="BTS.ReceivePortName" Operator="0" Value="RecvPort_MIFID_Response_In" /&gt;
  &lt;/Group&gt;
&lt;/Filter&gt;</Filter>
      <Transforms />
      <OrderedDelivery>false</OrderedDelivery>
      <Priority>5</Priority>
      <StopSendingOnFailure>false</StopSendingOnFailure>
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </SendPort>
  </SendPortCollection>
  <DistributionListCollection />
  <ReceivePortCollection>
    <ReceivePort Name="RecvPort_MIFID_Response_In" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_Response_In">
          <Description xsi:nil="true" />
          <Address>SFTP://krogerinv.prd@nrr-sftp-prd.abide-financial.com:22/Outgoing/ResponseFiles/MiFID/*.*</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2017-11-27T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2017-11-28T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="nsoftware.SFTP 2016" Capabilities="15627" ConfigurationClsid="7571227c-f326-4248-a478-8748270376f7" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;AdapterConfig vt="8"&gt;&amp;lt;Config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&amp;gt;&amp;lt;AfterConnect /&amp;gt;&amp;lt;AfterGet /&amp;gt;&amp;lt;BeforeGet /&amp;gt;&amp;lt;CertPassSSOAffiliate /&amp;gt;&amp;lt;DeleteMode&amp;gt;1&amp;lt;/DeleteMode&amp;gt;&amp;lt;ErrorThreshold&amp;gt;144&amp;lt;/ErrorThreshold&amp;gt;&amp;lt;FileMask&amp;gt;*.*&amp;lt;/FileMask&amp;gt;&amp;lt;Firewall&amp;gt;&amp;lt;AutoDetect&amp;gt;False&amp;lt;/AutoDetect&amp;gt;&amp;lt;FirewallType&amp;gt;0&amp;lt;/FirewallType&amp;gt;&amp;lt;Host /&amp;gt;&amp;lt;Password&amp;gt;******&amp;lt;/Password&amp;gt;&amp;lt;Port&amp;gt;0&amp;lt;/Port&amp;gt;&amp;lt;User /&amp;gt;&amp;lt;/Firewall&amp;gt;&amp;lt;MaxBatchSize&amp;gt;0&amp;lt;/MaxBatchSize&amp;gt;&amp;lt;MaxFileCount&amp;gt;10&amp;lt;/MaxFileCount&amp;gt;&amp;lt;MaxFileSize&amp;gt;0&amp;lt;/MaxFileSize&amp;gt;&amp;lt;Other /&amp;gt;&amp;lt;PersistentConnection&amp;gt;False&amp;lt;/PersistentConnection&amp;gt;&amp;lt;PollingInterval&amp;gt;600&amp;lt;/PollingInterval&amp;gt;&amp;lt;RemotePath&amp;gt;/Outgoing/ResponseFiles/MiFID&amp;lt;/RemotePath&amp;gt;&amp;lt;SSHAcceptServerHostKey&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;AcceptAny&amp;gt;True&amp;lt;/AcceptAny&amp;gt;&amp;lt;/SSHAcceptServerHostKey&amp;gt;&amp;lt;SSHAuthMode&amp;gt;0&amp;lt;/SSHAuthMode&amp;gt;&amp;lt;SSHCert&amp;gt;&amp;lt;Store&amp;gt;MY&amp;lt;/Store&amp;gt;&amp;lt;StorePassword&amp;gt;******&amp;lt;/StorePassword&amp;gt;&amp;lt;StoreType&amp;gt;0&amp;lt;/StoreType&amp;gt;&amp;lt;Subject /&amp;gt;&amp;lt;/SSHCert&amp;gt;&amp;lt;SSHCompressionAlgorithms&amp;gt;none&amp;lt;/SSHCompressionAlgorithms&amp;gt;&amp;lt;SSHHost&amp;gt; nrr-sftp-prd.abide-financial.com&amp;lt;/SSHHost&amp;gt;&amp;lt;SSHPassword&amp;gt;******&amp;lt;/SSHPassword&amp;gt;&amp;lt;SSHPort&amp;gt;22&amp;lt;/SSHPort&amp;gt;&amp;lt;SSHUser&amp;gt;krogerinv.prd&amp;lt;/SSHUser&amp;gt;&amp;lt;SSOAffiliate /&amp;gt;&amp;lt;TempPath /&amp;gt;&amp;lt;Timeout&amp;gt;300&amp;lt;/Timeout&amp;gt;&amp;lt;TransportLog&amp;gt;&amp;lt;Location&amp;gt;Application&amp;lt;/Location&amp;gt;&amp;lt;LogMode&amp;gt;2&amp;lt;/LogMode&amp;gt;&amp;lt;LogType&amp;gt;1&amp;lt;/LogType&amp;gt;&amp;lt;/TransportLog&amp;gt;&amp;lt;URIIdentity&amp;gt;SFTP://&amp;lt;/URIIdentity&amp;gt;&amp;lt;uri&amp;gt;SFTP://krogerinv.prd@nrr-sftp-prd.abide-financial.com:22/Outgoing/ResponseFiles/MiFID/*.*&amp;lt;/uri&amp;gt;&amp;lt;/Config&amp;gt;&lt;/AdapterConfig&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="nsoftware.SFTP 2016" Capabilities="15627" ConfigurationClsid="7571227c-f326-4248-a478-8748270376f7" />
          </ReceiveHandler>
        </ReceiveLocation>
        <ReceiveLocation Name="RecvLoc_MIFID_Response_In_TEST">
          <Description xsi:nil="true" />
          <Address>F:\krogerApplications\MIFID\BizTalk\IN\*.xml</Address>
          <PublicAddress />
          <Primary>false</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2017-11-28T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2017-11-29T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.xml&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>false</Enable>
          <ReceiveHandler Name="BizTalkServerApplication" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>51</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_Report_Out" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_Report_Out">
          <Description xsi:nil="true" />
          <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\MiFIDOutput\*.csv</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2017-11-28T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2017-11-29T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
        <ReceiveLocation Name="RecvLoc_MIFID_REPORT_OUT_TEST1">
          <Description xsi:nil="true" />
          <Address>F:\krogerApplications\MIFID\BizTalk\OUT\*.csv</Address>
          <PublicAddress />
          <Primary>false</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2018-02-27T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2018-02-28T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>false</Enable>
          <ReceiveHandler Name="ACD_Host1_64" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>51</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_OnDemand" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_OnDemand">
          <Description xsi:nil="true" />
          <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\OnDemand\*.csv</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2017-12-21T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2017-12-22T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
        <ReceiveLocation Name="RecvLoc_MIFID_OnDemand_TEST">
          <Description xsi:nil="true" />
          <Address>F:\krogerApplications\MIFID\BizTalk\OnDemand\*.csv</Address>
          <PublicAddress />
          <Primary>false</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2017-12-21T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2017-12-22T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>false</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>51</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_Report_Out_TEST" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_Report_Out_TEST">
          <Description xsi:nil="true" />
          <Address>F:\krogerApplications\MIFID\BizTalk\TEST\IN\*.csv</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2018-01-05T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2018-01-06T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>false</Enable>
          <ReceiveHandler Name="ACD_Host1_64" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>0</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_UBS_Holdings" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_UBS_Holdings">
          <Description xsi:nil="true" />
          <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\Original\FISSEC*</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>true</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T00:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T09:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2018-02-01T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2018-02-02T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;FISSEC*&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>51</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_UBS_SecTransactions" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_UBS_SecTransactions">
          <Description xsi:nil="true" />
          <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\Original\FISMOV*</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>true</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T00:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T09:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2018-02-01T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2018-02-02T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;FISMOV*&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>51</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
    <ReceivePort Name="RecvPort_MIFID_UBS_Email" IsTwoWay="false" BindingOption="0">
      <Description xsi:nil="true" />
      <ReceiveLocations>
        <ReceiveLocation Name="RecvLoc_MIFID_UBS_Email">
          <Description xsi:nil="true" />
          <Address>\\fi.com\departments\Trading\!Autoprocess\MiFID\IN\UBSEurope\Original\FIMFIS*.csv</Address>
          <PublicAddress />
          <Primary>true</Primary>
          <ReceiveLocationServiceWindowEnabled>false</ReceiveLocationServiceWindowEnabled>
          <ReceiveLocationFromTime>2000-01-01T08:00:00</ReceiveLocationFromTime>
          <ReceiveLocationToTime>2000-01-01T07:59:59</ReceiveLocationToTime>
          <ReceiveLocationStartDateEnabled>false</ReceiveLocationStartDateEnabled>
          <ReceiveLocationStartDate>2018-02-02T00:00:00</ReceiveLocationStartDate>
          <ReceiveLocationEndDateEnabled>false</ReceiveLocationEndDateEnabled>
          <ReceiveLocationEndDate>2018-02-03T23:59:59</ReceiveLocationEndDate>
          <ReceiveLocationTransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          <ReceiveLocationTransportTypeData>&lt;CustomProps&gt;&lt;RenameReceivedFiles vt="11"&gt;0&lt;/RenameReceivedFiles&gt;&lt;RemoveReceivedFileDelay vt="19"&gt;10&lt;/RemoveReceivedFileDelay&gt;&lt;RemoveReceivedFileMaxInterval vt="19"&gt;300000&lt;/RemoveReceivedFileMaxInterval&gt;&lt;FileMask vt="8"&gt;FIMFIS*.csv&lt;/FileMask&gt;&lt;FileNetFailRetryInt vt="19"&gt;5&lt;/FileNetFailRetryInt&gt;&lt;RemoveReceivedFileRetryCount vt="19"&gt;5&lt;/RemoveReceivedFileRetryCount&gt;&lt;BatchSizeInBytes vt="19"&gt;102400&lt;/BatchSizeInBytes&gt;&lt;PollingInterval vt="19"&gt;60000&lt;/PollingInterval&gt;&lt;FileNetFailRetryCount vt="19"&gt;5&lt;/FileNetFailRetryCount&gt;&lt;BatchSize vt="19"&gt;20&lt;/BatchSize&gt;&lt;/CustomProps&gt;</ReceiveLocationTransportTypeData>
          <ReceivePipeline Name="Microsoft.BizTalk.DefaultPipelines.PassThruReceive" FullyQualifiedName="Microsoft.BizTalk.DefaultPipelines.PassThruReceive, Microsoft.BizTalk.DefaultPipelines, Version=3.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" Type="1" TrackingOption="ServiceStartEnd MessageSendReceive PipelineEvents" Description="" />
          <ReceivePipelineData xsi:nil="true" />
          <SendPipeline xsi:nil="true" />
          <SendPipelineData xsi:nil="true" />
          <Enable>true</Enable>
          <ReceiveHandler Name="MIFID_HOST" HostTrusted="false">
            <TransportType Name="FILE" Capabilities="11" ConfigurationClsid="5e49e3a6-b4fc-4077-b44c-22f34a242fdb" />
          </ReceiveHandler>
        </ReceiveLocation>
      </ReceiveLocations>
      <SendPipelineData xsi:nil="true" />
      <Authentication>0</Authentication>
      <Tracking>0</Tracking>
      <Transforms />
      <RouteFailedMessage>false</RouteFailedMessage>
      <ApplicationName>MIFID</ApplicationName>
    </ReceivePort>
  </ReceivePortCollection>
  <PartyCollection xsi:nil="true" />
</BindingInfo>